<!-- <div class="dash-container">
  
  <div class="dash-header">
    <div class="dash-header-left">
      <div class="dash-control">
        <span class="dash-label">Period</span>
        <button class="dash-btn-filter" (click)="toggleDatePicker()" [class.active]="dateRangeOpen">
          <span style="display:flex; align-items:center; gap:8px;">
            <span class="icon">üóìÔ∏è</span>
            <span>{{ startDate() | date:'mediumDate' }} ‚Äî {{ endDate() | date:'mediumDate' }}</span>
          </span>
          <span class="chevron">‚ñº</span>
        </button>
      </div>
      <div class="dash-control">
        <span class="dash-label">Compare</span>
        <div class="dash-select-wrap">
          <select [(ngModel)]="compareMode" (change)="recompute()">
            <option value="prevPeriod">Previous Period</option>
            <option value="prevYear">Same Period Last Year</option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="dash-header-right">
      <div class="dash-control">
        <span class="dash-label">Group By</span>
        <div class="dash-select-wrap">
          <select [(ngModel)]="intervalStr" (change)="setInterval(intervalStr)">
            <option value="day">Daily</option>
            <option value="week">Weekly</option>
            <option value="month">Monthly</option>
          </select>
        </div>
      </div>
      <div class="dash-control">
        <span class="dash-label">Currency</span>
        <div class="dash-select-wrap">
          <select [(ngModel)]="currency" (change)="onCurrencyChange()">
            <option value="INR">‚Çπ INR</option>
            <option value="USD">$ USD</option>
          </select>
        </div>
      </div>

      @if (dateRangeOpen) {
        <div class="dash-popover" (click)="$event.stopPropagation()">
          <div class="pop-sidebar">
            <ul class="pop-list">
              <li (click)="applyPresetAndPreview('today')" [class.active]="previewPreset==='today'">Today</li>
              <li (click)="applyPresetAndPreview('7d')" [class.active]="previewPreset==='7d'">Last 7 Days</li>
              <li (click)="applyPresetAndPreview('30d')" [class.active]="previewPreset==='30d'">Last 30 Days</li>
              <li (click)="applyPresetAndPreview('lastMonth')" [class.active]="previewPreset==='lastMonth'">Last Month</li>
            </ul>
          </div>
          <div class="pop-main">
            <div class="pop-inputs">
              <input type="date" [(ngModel)]="tempStartStr">
              <input type="date" [(ngModel)]="tempEndStr">
            </div>
            <div class="pop-actions">
              <button class="dash-btn ghost" (click)="cancelDatePicker()">Cancel</button>
              <button class="dash-btn primary" (click)="applyDatePicker()">Apply</button>
            </div>
          </div>
        </div>
      }
    </div>
  </div>

  <div class="dash-stats-grid">
    <div class="stat-card">
      <div class="stat-top">
        <span class="stat-title">Total Sales</span>
        <span class="stat-badge" [ngClass]="{ up: totalSalesChange >= 0, down: totalSalesChange < 0 }">
          {{ totalSalesChange >= 0 ? '‚Üë' : '‚Üì' }} {{ totalSalesChange | number:'1.0-0' }}%
        </span>
      </div>
      <div class="stat-value">{{ curSymbol }}{{ fx(totalSales) | number:'1.0-0' }}</div>
      <div class="stat-chart-wrap">
        <canvas baseChart [type]="'line'" [data]="kpiSparklines['sales']" [options]="sparklineOptions"></canvas>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-top">
        <span class="stat-title">Total Orders</span>
        <span class="stat-badge" [ngClass]="{ up: ordersChange >= 0, down: ordersChange < 0 }">
          {{ ordersChange >= 0 ? '‚Üë' : '‚Üì' }} {{ ordersChange | number:'1.0-0' }}%
        </span>
      </div>
      <div class="stat-value">{{ totalOrders | number:'1.0-0' }}</div>
      <div class="stat-chart-wrap">
        <canvas baseChart [type]="'line'" [data]="kpiSparklines['orders']" [options]="sparklineOptions"></canvas>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-top">
        <span class="stat-title">Avg. Order Value</span>
        <span class="stat-badge" [ngClass]="{ up: averageOrderValueChange >= 0, down: averageOrderValueChange < 0 }">
          {{ averageOrderValueChange >= 0 ? '‚Üë' : '‚Üì' }} {{ averageOrderValueChange | number:'1.0-0' }}%
        </span>
      </div>
      <div class="stat-value">{{ curSymbol }}{{ fx(averageOrderValue) | number:'1.2-2' }}</div>
      <div class="stat-chart-wrap">
        <canvas baseChart [type]="'line'" [data]="kpiSparklines['aov']" [options]="sparklineOptions"></canvas>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-top">
        <span class="stat-title">Net Profit Margin</span>
        <span class="stat-badge" [ngClass]="{ up: profitMarginChange >= 0, down: profitMarginChange < 0 }">
          {{ profitMarginChange >= 0 ? '‚Üë' : '‚Üì' }} {{ profitMarginChange | number:'1.0-1' }}%
        </span>
      </div>
      <div class="stat-value">{{ profitMargin | number:'1.1-1' }}%</div>
      <div class="stat-chart-wrap">
        <canvas baseChart [type]="'line'" [data]="kpiSparklines['profitMargin']" [options]="sparklineOptions"></canvas>
      </div>
    </div>
  </div>

  <div class="dash-content-grid">
    
    <div class="content-card wide-card">
      <div class="card-header">
        <h3>Performance Over Time</h3>
      </div>
      <div class="chart-container">
        <canvas baseChart [type]="'line'" [data]="salesVsOrdersLineData" [options]="salesVsOrdersLineOptions"></canvas>
      </div>
    </div>

    <div class="content-card sales-channel-card">
      <div class="card-header">
        <h3>Sales by Channel</h3>
      </div>
      <div class="donut-container">
        <canvas baseChart [type]="'doughnut'" [data]="salesDoughnutData" [options]="doughnutOptions"></canvas>
      </div>
    </div>

    <div class="content-card stock-card">
      <div class="card-header">
        <h3>Stock Value by Category</h3>
      </div>
      <div class="donut-container">
        <canvas baseChart [type]="'doughnut'" [data]="inventoryDoughnutData" [options]="doughnutOptions"></canvas>
      </div>
      <div style="text-align: center; margin-top: auto; padding-top: 20px;">
        <h3 style="margin: 0; font-size: 1.25rem; font-weight: 800; color: var(--text-main);">
          Total: {{ curSymbol }}{{ fx(inventoryValue) | number:'1.0-0' }}
        </h3>
      </div>
    </div>

    <div class="content-card products-card">
      <div class="card-header">
        <h3>Top Categories</h3>
      </div>
      <div class="list-container custom-scrollbar">
        @for (p of topCategories; track p.name) {
          <div class="list-row">
            <div class="row-info">
              <span class="row-name">{{ p.name }}</span>
              <b class="row-val">{{ curSymbol }}{{ fx(p.revenue) | number:'1.0-0' }}</b>
            </div>
            <div class="row-bar-bg">
              <div class="row-bar-fill" [style.width.%]="p.percent"></div>
            </div>
          </div>
        }
        @if (!topCategories.length) { <div class="empty-state">No data available.</div> }
      </div>
    </div>

    <div class="content-card activity-card">
      <div class="card-header">
        <h3>Recent Activity</h3>
      </div>
      <div class="table-container custom-scrollbar">
        <table class="dash-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Revenue</th>
              <th>Orders</th>
            </tr>
          </thead>
          <tbody>
            @for (log of recentDailyLog; track log.date) {
              <tr>
                <td class="table-date">{{ log.date | date:'MMM d' }}</td>
                <td><b class="table-revenue">{{ curSymbol }}{{ fx(log.sales) | number:'1.0-0' }}</b></td>
                <td class="table-orders">
                  <span class="order-pill">{{ log.orders }}</span>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div> -->

<div class="dash-container">
  
  <div class="dash-header">
    <div class="dash-header-left">
      <div class="dash-control">
        <span class="dash-label">Store</span>
        <div class="dash-select-wrap">
          <select [(ngModel)]="storeSlug" (change)="onStoreChange()">
            @if (storesList.length > 1) {
              <option value="ALL">All Stores (Consolidated)</option>
            }
            @for (s of storesList; track s.slug) {
              <option [value]="s.slug">{{ s.name }}</option>
            }
            @if (storesList.length === 0) {
              <option value="" disabled>No outlets found</option>
            }
          </select>
        </div>
      </div>

      <div class="dash-control">
        <span class="dash-label">Period</span>
        <button class="dash-btn-filter" (click)="toggleDatePicker()" [class.active]="dateRangeOpen">
          <span style="display:flex; align-items:center; gap:8px;">
            <span class="icon">üóìÔ∏è</span>
            <span>{{ startDate() | date:'mediumDate' }} ‚Äî {{ endDate() | date:'mediumDate' }}</span>
          </span>
          <span class="chevron">‚ñº</span>
        </button>
      </div>

      <div class="dash-control">
        <span class="dash-label">Compare</span>
        <div class="dash-select-wrap">
          <select [(ngModel)]="compareMode" (change)="recompute()">
            <option value="prevPeriod">Previous Period</option>
            <option value="prevYear">Same Period Last Year</option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="dash-header-right">
      <div class="dash-control">
        <span class="dash-label">Group By</span>
        <div class="dash-select-wrap">
          <select [(ngModel)]="intervalStr" (change)="setInterval(intervalStr)">
            <option value="day">Daily</option>
            <option value="week">Weekly</option>
            <option value="month">Monthly</option>
          </select>
        </div>
      </div>
      <div class="dash-control">
        <span class="dash-label">Currency</span>
        <div class="dash-select-wrap">
          <select [(ngModel)]="currency" (change)="onCurrencyChange()">
            <option value="INR">‚Çπ INR</option>
            <option value="USD">$ USD</option>
          </select>
        </div>
      </div>

      @if (dateRangeOpen) {
        <div class="dash-popover" (click)="$event.stopPropagation()">
          <div class="pop-sidebar">
            <ul class="pop-list">
              <li (click)="applyPresetAndPreview('today')" [class.active]="previewPreset==='today'">Today</li>
              <li (click)="applyPresetAndPreview('7d')" [class.active]="previewPreset==='7d'">Last 7 Days</li>
              <li (click)="applyPresetAndPreview('30d')" [class.active]="previewPreset==='30d'">Last 30 Days</li>
              <li (click)="applyPresetAndPreview('lastMonth')" [class.active]="previewPreset==='lastMonth'">Last Month</li>
            </ul>
          </div>
          <div class="pop-main">
            <div class="pop-inputs">
              <input type="date" [(ngModel)]="tempStartStr">
              <input type="date" [(ngModel)]="tempEndStr">
            </div>
            <div class="pop-actions">
              <button class="dash-btn ghost" (click)="cancelDatePicker()">Cancel</button>
              <button class="dash-btn primary" (click)="applyDatePicker()">Apply</button>
            </div>
          </div>
        </div>
      }
    </div>
  </div>

  <div class="dash-stats-grid">
    <div class="stat-card">
      <div class="stat-top">
        <span class="stat-title">Total Sales</span>
        <span class="stat-badge" [ngClass]="{ up: totalSalesChange >= 0, down: totalSalesChange < 0 }">
          {{ totalSalesChange >= 0 ? '‚Üë' : '‚Üì' }} {{ totalSalesChange | number:'1.0-0' }}%
        </span>
      </div>
      <div class="stat-value">{{ curSymbol }}{{ fx(totalSales) | number:'1.0-0' }}</div>
      <div class="stat-chart-wrap">
        <canvas baseChart [type]="'line'" [data]="kpiSparklines['sales']" [options]="sparklineOptions"></canvas>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-top">
        <span class="stat-title">Total Orders</span>
        <span class="stat-badge" [ngClass]="{ up: ordersChange >= 0, down: ordersChange < 0 }">
          {{ ordersChange >= 0 ? '‚Üë' : '‚Üì' }} {{ ordersChange | number:'1.0-0' }}%
        </span>
      </div>
      <div class="stat-value">{{ totalOrders | number:'1.0-0' }}</div>
      <div class="stat-chart-wrap">
        <canvas baseChart [type]="'line'" [data]="kpiSparklines['orders']" [options]="sparklineOptions"></canvas>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-top">
        <span class="stat-title">Avg. Order Value</span>
        <span class="stat-badge" [ngClass]="{ up: averageOrderValueChange >= 0, down: averageOrderValueChange < 0 }">
          {{ averageOrderValueChange >= 0 ? '‚Üë' : '‚Üì' }} {{ averageOrderValueChange | number:'1.0-0' }}%
        </span>
      </div>
      <div class="stat-value">{{ curSymbol }}{{ fx(averageOrderValue) | number:'1.2-2' }}</div>
      <div class="stat-chart-wrap">
        <canvas baseChart [type]="'line'" [data]="kpiSparklines['aov']" [options]="sparklineOptions"></canvas>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-top">
        <span class="stat-title">Net Profit Margin</span>
        <span class="stat-badge" [ngClass]="{ up: profitMarginChange >= 0, down: profitMarginChange < 0 }">
          {{ profitMarginChange >= 0 ? '‚Üë' : '‚Üì' }} {{ profitMarginChange | number:'1.0-1' }}%
        </span>
      </div>
      <div class="stat-value">{{ profitMargin | number:'1.1-1' }}%</div>
      <div class="stat-chart-wrap">
        <canvas baseChart [type]="'line'" [data]="kpiSparklines['profitMargin']" [options]="sparklineOptions"></canvas>
      </div>
    </div>
  </div>

  <div class="dash-content-grid">
    
    <div class="content-card wide-card">
      <div class="card-header">
        <h3>Performance Over Time</h3>
      </div>
      <div class="chart-container">
        <canvas baseChart [type]="'line'" [data]="salesVsOrdersLineData" [options]="salesVsOrdersLineOptions"></canvas>
      </div>
    </div>

    <div class="content-card sales-channel-card">
      <div class="card-header">
        <h3>Sales by Channel</h3>
      </div>
      <div class="donut-container">
        <canvas baseChart [type]="'doughnut'" [data]="salesDoughnutData" [options]="doughnutOptions"></canvas>
      </div>
    </div>

    <div class="content-card stock-card">
      <div class="card-header">
        <h3>Stock Value by Category</h3>
      </div>
      <div class="donut-container">
        <canvas baseChart [type]="'doughnut'" [data]="inventoryDoughnutData" [options]="doughnutOptions"></canvas>
      </div>
      <div style="text-align: center; margin-top: auto; padding-top: 20px;">
        <h3 style="margin: 0; font-size: 1.25rem; font-weight: 800; color: var(--text-main);">
          Total: {{ curSymbol }}{{ fx(inventoryValue) | number:'1.0-0' }}
        </h3>
      </div>
    </div>

    <div class="content-card products-card">
      <div class="card-header">
        <h3>Top Categories</h3>
      </div>
      <div class="list-container custom-scrollbar">
        @for (p of topCategories; track p.name) {
          <div class="list-row">
            <div class="row-info">
              <span class="row-name">{{ p.name }}</span>
              <b class="row-val">{{ curSymbol }}{{ fx(p.revenue) | number:'1.0-0' }}</b>
            </div>
            <div class="row-bar-bg">
              <div class="row-bar-fill" [style.width.%]="p.percent"></div>
            </div>
          </div>
        }
        @if (!topCategories.length) { <div class="empty-state">No data available.</div> }
      </div>
    </div>

    <div class="content-card activity-card">
      <div class="card-header">
        <h3>Recent Activity</h3>
      </div>
      <div class="table-container custom-scrollbar">
        <table class="dash-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Revenue</th>
              <th>Orders</th>
            </tr>
          </thead>
          <tbody>
            @for (log of recentDailyLog; track log.date) {
              <tr>
                <td class="table-date">{{ log.date | date:'MMM d' }}</td>
                <td><b class="table-revenue">{{ curSymbol }}{{ fx(log.sales) | number:'1.0-0' }}</b></td>
                <td class="table-orders">
                  <span class="order-pill">{{ log.orders }}</span>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>