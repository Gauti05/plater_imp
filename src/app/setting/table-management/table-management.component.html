<div class="table-management-wrapper">
  <div class="header-row">
    <div><h2 class="page-title">Table Management</h2></div>
    
    <div style="display: flex; gap: 12px; align-items: center;">
      <button class="btn outline" (click)="openQrModal()" *ngIf="tables.length > 0">ğŸ–¨ï¸ Print All QRs</button>
      <button class="btn primary add-table-btn" (click)="openSidebar()">+ Add Table</button>
    </div>
  </div>

  <div class="floor-layout wood-theme">
    @if (tables.length > 0) {
      <div class="table-grid">
        @for (table of tables; track table.id) {
          <div class="table-visual table-{{ table.status }}" (click)="editTable(table)">
            <div class="table-circle"
                 [style.border-color]="getStatusColor(table)"
                 [style.box-shadow]="getShadowForStatus(table)">
              <div class="chairs" [style.--chairs]="table.capacity">
                @for (c of [].constructor(table.capacity); track $index) {
                  <div class="chair" [style.--index]="$index"></div>
                }
              </div>
              <div class="table-number">T{{ table.number }}</div>
            </div>
            <div class="table-status">
              {{ table.status | titlecase }}
              @if (table.capacity) { <span>({{ table.capacity }} seats)</span> }
            </div>
          </div>
        }
      </div>
    } @else {
      <p class="empty-state">No tables yet. Click â€œAdd Tableâ€ to create one.</p>
    }
  </div>

  <div class="drawer" [class.open]="sidebarOpen">
    <div class="drawer-header">
      <h3>{{ isEditing ? 'Edit Table' : 'Add New Table' }}</h3>
      <button class="close-btn" (click)="closeSidebar()">Ã—</button>
    </div>

    <div class="drawer-body">
      <div class="form-group">
        <label for="table-number">Table Number</label>
        <input id="table-number" type="number" name="tableNumber" [(ngModel)]="form.number" />
      </div>

      <div class="form-group">
        <label for="table-capacity">Capacity</label>
        <input id="table-capacity" type="number" name="tableCapacity" [(ngModel)]="form.capacity" min="1" max="12" />
      </div>

      <div class="form-group">
        <label for="table-status">Status</label>
        <select id="table-status" name="tableStatus" [(ngModel)]="form.status">
          <option value="available">ğŸŸ¢ Available</option>
          <option value="occupied">ğŸ”´ Occupied</option>
          <option value="reserved">ğŸŸ¡ Reserved</option>
        </select>
      </div>

   @if (form.number && storeSlug) {
        <div class="qr-section">
          <label>Table QR Code</label>
          <div class="qr-container">
            <qrcode
              [qrdata]="getQrData(form.number)"
              [width]="200"
              [errorCorrectionLevel]="'H'" 
              [margin]="2"
              [colorDark]="'#000000'"
              [colorLight]="'#ffffff'"
              [imageSrc]="'https://platter.bizzeazy.com/logo.jpg'"
              [imageHeight]="50"
              [imageWidth]="50"
            ></qrcode>
          </div>
          
          <p class="qr-link">{{ getQrData(form.number) }}</p>
          
          <button class="btn outline full" (click)="downloadQrCode(form.number)">
            â¬‡ Download QR Code
          </button>
        </div>
      }
      <div style="margin-top: 20px;">
        <button class="btn primary full create-btn" (click)="saveTable()" [disabled]="loading || !form.number || !form.capacity">
          {{ loading ? 'Saving...' : isEditing ? 'Update Table' : 'Create Table' }}
        </button>
      </div>

      @if (successMessage) {
        <p class="success-msg">{{ successMessage }}</p>
      }
    </div>
  </div>

  <div class="overlay" [class.show]="sidebarOpen" (click)="closeSidebar()"></div>

  @if (showQrModal) {
    <div class="qr-print-backdrop">
      <div class="qr-print-modal">
        <div class="modal-header no-print">
          <h3 style="margin:0; font-size:18px; color:var(--text-main);">Print Table QR Codes</h3>
          <div>
            <button class="btn outline" (click)="closeQrModal()" style="margin-right: 10px; padding: 8px 16px;">Cancel</button>
            <button class="btn primary" (click)="printQRs()" style="padding: 8px 16px;">ğŸ–¨ï¸ Print Document</button>
          </div>
        </div>
        
        <div class="modal-body printable-area">
          <div class="qr-doc-header no-print" style="margin-bottom: 20px; text-align:center; color: var(--text-muted);">
            Ensure your printer is set to "Print Backgrounds" for best results. Cut along the borders to place on tables!
          </div>
          
          <div class="qr-grid">
            @for (table of tables; track table.id) {
              <div class="qr-card">
                <h4 style="margin: 0 0 12px 0; color: #1f2937; font-size: 20px;">Table {{ table.number }}</h4>
                <qrcode
                  [qrdata]="getQrData(table.number)"
                  [width]="160"
                  [errorCorrectionLevel]="'M'" 
                  [margin]="1"
                  [colorDark]="'#000000'"
                  [colorLight]="'#ffffff'"
                ></qrcode>
                <p style="margin: 12px 0 0 0; font-size: 12px; color: #6b7280; font-weight: 500; text-transform: uppercase; letter-spacing: 1px;">
                  Scan for Menu
                </p>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }

</div>