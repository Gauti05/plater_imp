<div class="table-container">
  <div class="table-tools">
    <div class="tools-left">
      <div class="search-wrapper">
        <input type="text" class="search-box" placeholder="Search records..." [(ngModel)]="searchText" (input)="onQueryChange()" />
      </div>

      <button class="btn btn-secondary" (click)="resetFilters()">Reset</button>
      <button class="btn btn-secondary" (click)="exportCSV()">Export CSV</button>
    </div>

    <button *ngIf="buttonLabel" (click)="onButtonClick()" class="btn btn-primary">
      + {{ buttonLabel }}
    </button>
  </div>

  <div class="table-wrapper">
    <table class="biz-table">
      <thead>
        <tr>
          <th class="checkbox-col">
            <input type="checkbox" [(ngModel)]="allSelected" (change)="toggleAll()" />
          </th>
          @for (col of columns; track col.field) {
            <th (click)="toggleSort(col)" class="sortable-header">
              {{ col.label }}
              <span *ngIf="sortField === col.field">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
            </th>
          }
        </tr>
      </thead>
      <tbody>
        @for (row of paginatedData; track row) {
          <tr (click)="onRowClick(row)" class="clickable-row">
            <td class="checkbox-col" (click)="$event.stopPropagation()">
              <input type="checkbox" [(ngModel)]="row.selected" (change)="updateSelected(row)" />
            </td>
            @for (col of columns; track col.field) {
              <td>
                @if (col.field === 'lastVisited') {
                  {{ row[col.field] | date:'medium' }}
                } @else if (col.field === 'tier' || col.field === 'loyaltyTier') {
                   <span class="badge-tier">{{ row[col.field] }}</span>
                } @else {
                  {{ row[col.field] }}
                }
              </td>
            }
          </tr>
        }
        @if (paginatedData.length === 0) {
          <tr><td [attr.colspan]="columns.length + 1" class="text-center py-5">No records found</td></tr>
        }
      </tbody>
    </table>
  </div>

  <div class="table-footer" *ngIf="showPagination">
    <div class="footer-info">
      Showing page {{ currentPage + 1 }} of {{ totalPages }}
    </div>
    <div class="footer-actions">
      <button class="btn btn-secondary" [disabled]="currentPage === 0" (click)="prevPage()">Previous</button>
      <button class="btn btn-secondary" [disabled]="currentPage + 1 >= totalPages" (click)="nextPage()">Next</button>
    </div>
  </div>
</div>